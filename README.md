## 지하철 정보 관리


### 미션 포인트 ⏰ 
   - 인수테스트의 목적 및 사용법을 파악한다.
   - 인수테스트 -> 레이어 테스트 -> 도메인 테스트로 이어지는 사이클을 경험하고 체화한다.
   - TDD를 체화한다.
   - 테스트 위주로 어려운 도메인 로직을 구현한다.
   - (어려운 프론트도 함께 한다..)
### 학습 내용 및 회고
   - 인수테스트를 통해 어플리케이션 전반의 경우를 실제로 테스트할 수 있다.
   - 인수테스트 -> 레이어 -> 도메인 TDD 사이클은 안정감있는 어플리케이션을 구축하는데 도움이 된다.
   - 테스트는 Given When Then의 구조로 작성할 때 가장 가독성과 목적에 충실하다고 느낌.
   - MockMvc와 RestAssured의 차이를 이해함
      - RestAssured -> 실제로 요청을 보내서 확인한다.(인수테스트에 더 적절하다고 판단)
      - MockMvc -> 실제 서버환경과 동일한 가상의 서버로 요청을 보낸다. (컨트롤러에 적절하다고 판단)
   - RESTful한 API 형태를 지키고자 고민 및 노력함.(HATOAS를 제외한, 리소스 관리 및 표기 등에 대해서)
      - POST, PUT과 같은 값들은 변화된 상태를 함께 반환하지 않는다.      
      - 소문자와 - 를 사용하여 URL을 구성한다.
   - 필요한 경우 Repository에서 발생하는 예외를 구체적인 예외로 변환할 수 있다.
   - Spring Data JDBC는 All-arg 생성자를 추가하고, 이외의 생성자는 팩토리 메서드를 통해 작성하면 효율이 가장 좋다.(문서참고)
   - DTO를 변환할 때는 DTO내에서 Entity로 변환하거나, DTO 매퍼를 통해서 변환하는 것이 바람직하다.(변화가 많이 일어나는 곳에서, 적게 일어나는 곳으로 의존하자)
   - 사용하지 않는 부분이나 유의해야할 부분은 접근제어자를 통해 의도를 드러내자. (private 생성자와 같이)
   - 모든 도메인은 뷰에 그대로 노출되면 안된다. DTO로 감싸는 형태로 반환하자.(API 스펙 및 특정 API에 종속적인 도메인, 뷰와 도메인의 결합 등의 이유)
   
### 어려웠던 부분 😂
   - API 규약에 대한 부분이 낯설어서 어떤 상태값을 주고, 어떤 형태로 반환해야하는지 어려웠다. 이를 공부하며 아래의 것들을 학습할 수 있었다.
      - DTO의 존재 이유
      - 일반적으로 사용되는 Status Code 값
      - GET/POST/PUT/PATCH/DELETE에서 일어나는 요청 및 응답
   - LineStation을 도메인으로 분리하는 것이 맞을지가 어려웠음.
      - 객체와 데이터베이스 사이의 관계에 대한 지식이 부족해, Line-LineStation-Station의 관계를 어떻게 가져가야할지 고민했었음.
      - 당시에는 LineStation을 아이디 없는 단순 테이블의 형태로 구성하였는데, 현재라면 ID가 존재하고, 독립적인 엔티티로 가져갈 것 같음.    
   - 서버와 클라이언트의 역할에 대해 명확하게 알기 힘들었음.
      - 어떤 형태로 응답해야하며, 어디까지 서버가 어디까지 프론트가 해주는 것인지 애매했음.
      - 결론적으로는 서버와 프론트가 독립적으로 최대한 작업을 수행하는 형태가 바람직하다고 생각함.

<br/>

## 기능 요구사항

### Level 1

#### 시나리오
```gherkin
Feature: 지하철 노선 관리

  Scenario: 지하철 노선을 관리한다.
    When 지하철 노선 n개 추가 요청을 한다.
    Then 지하철 노선이 추가 되었다.
    
    When 지하철 노선 목록 조회 요청을 한다.
    Then 지하철 노선 목록을 응답 받는다.
    And 지하철 노선 목록은 n개이다.
    
    When 지하철 노선 수정 요청을 한다.
    Then 지하철 노선이 수정 되었다.

    When 지하철 노선 제거 요청을 한다.
    Then 지하철 노선이 제거 되었다.
    
    When 지하철 노선 목록 조회 요청을 한다.
    Then 지하철 노선 목록을 응답 받는다.
    And 지하철 노선 목록은 n-1개이다.
```
#### TO-DO
- [x] create : 지하철 노선을 추가할 수 있다.
- [x] read : 지하철 노선을 조회할 수 있다.
    - [x] `findAll`
    - [x] `findById`
- [x] update : 지하철 노선 및 시간을 변경할 수 있다.
- [x] delete : 등록된 노선을 삭제할 수 있다.

- [x] refactor
- [x] 지하철 노선명 중복 체크
### Level 2

#### TO-DO

- [x] 지하철 노선 관리 페이지
    - [x] 페이지 호출 시 미리 저장한 지하철 노선 조회
    - [x] 지하철 노선 목록 조회 API 사용
- [x] 노선 추가
    - [x] 노선 추가 버튼을 누르면 아래와 같은 팝업화면이 뜸
    - [x] 노선 이름과 정보를 입력
    - [x] 지하철 노선 추가 API 사용
- [x] 노선 상세 정보 조회
    - [x] 목록에서 노선 선택 시 상세 정보를 조회
- [x] 노선 수정
    - [x] 목록에서 우측 수정 버튼을 통해 수정 팝업화면 노출
    - [x] 수정 팝업 노출 시 기존 정보는 입력되어 있어야 함
    - [x] 정보 수정 후 지하철 노선 수정 API 사용
- [x] 노선 삭제
    - [x] 목록에서 우측 삭제 버튼을 통해 삭제
    - [x] 지하철 노선 삭제 API 사용

    
### Level 3


#### 시나리오

```gherkin
Feature: 지하철 노선에 역 추가 / 제거

Scenario: 지하철 노선에 역을 추가하고 제거한다.
     Given 지하철역이 여러 개 추가되어있다.
     And 지하철 노선이 추가되어있다.

     When 지하철 노선에 지하철역을 등록하는 요청을 한다.
     Then 지하철역이 노선에 추가 되었다.

     When 지하철 노선의 지하철역 목록 조회 요청을 한다.
     Then 지하철역 목록을 응답 받는다.
     And 새로 추가한 지하철역을 목록에서 찾는다.

     When 지하철 노선에 포함된 특정 지하철역을 제외하는 요청을 한다.
     Then 지하철역이 노선에서 제거 되었다.

     When 지하철 노선의 지하철역 목록 조회 요청을 한다.
     Then 지하철역 목록을 응답 받는다.
     And 제외한 지하철역이 목록에 존재하지 않는다.
```

#### TO-DO (mock 객체를 사용해서 구현)

- [x] 지하철 노선에 역 추가
    - [x] 노선에 지하철 역이 추가될 경우 아래의 정보가 추가되어야 함
        - [x] 이전역과의 거리
        - [x] 이전역과의 소요시간
- [x] 지하철 노선에 역 제거
    - [x] 노선과 제거할 지하철역 식별값을 전달
    

### Level 4

#### 시나리오
```gherkin

```

#### 기능 제약 조건
- 한 노선의 출발역은 하나만 존재하고 단방향으로 관리함
    - 실재 운행 시 양쪽 두 종점이 출발역이 되겠지만 관리의 편의를 위해 단방향으로 관리
    - 추후 경로 검색이나 시간 측정 시 양방향을 고려 할 예정
- 한 노선에서 두 갈래로 갈라지는 경우는 없음
- 이전역이 없는 경우 출발역으로 간주


#### TO-DO 

- [x] 지하철 노선에 역 추가
    - [x] 마지막 역이 아닌 뒷 따르는 역이 있는경우 재배치를 함
    - [x] 노선에 A - B - C 역이 연결되어 있을 때 B 다음으로 D라는 역을 추가할 경우 A - B - D - C로 재배치 됨
- [x] 지하철 노선에 역 제거
    - [x] 출발역이 제거될 경우 출발역 다음으로 오던 역이 출발역으로 됨
    - [x] 중간역이 제거될 경우 재배치를 함
        - [x] 노선에 A - B - D - C 역이 연결되어 있을 때 B역을 제거할 경우 A - B - C로 재배치 됨

- 프론트 연동
    - [x] 지하철역 추가
    
### Level 5

#### 요구사항
- 지하철 구간 관리 페이지 연동하기
- 앞 단계에서 구현되지 않은 기능이라 하더라도 필요시 구현해서 사용 가능

#### 기능 목록
- [x] 구간 페이지 연동
    - [x] 전체 노선 목록과 노선에 등록된 지하철역 목록을 통해 페이지 로드
    - [x] 지하철역 목록을 조회하는 방법은 자유롭게 선택 가능(제약을 두지 않음)
        - [x] 최초 페이지 로드 시 모든 정보를 포함하는 방법
- [x] 구간 추가
    - [x] 추가 버튼과 팝업화면을 통해 추가
- [x] 구간 제거
    - [x] 목록 우측 제거 버튼을 통해 제거    

    
    




